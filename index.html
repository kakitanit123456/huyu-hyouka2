<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>4年理科 評価記録ツール（冬プロ）</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
<header>
  <div class="wrap">
    <div class="headerBar">
      <div class="headerLeft">
        <h1>4年理科 評価記録ツール（冬の自然探究プロジェクト）</h1>
        <div class="sub">localStorageのみ（オフライン）</div>
      </div>

      <div class="headerActions">
        <button class="btn" id="btnTheme" type="button">🌙</button>
        <button class="btn" id="btnExport" type="button">エクスポート</button>
        <button class="btn" id="btnImport" type="button">インポート</button>
        <button class="btn danger" id="btnReset" type="button">全データ削除</button>
      </div>
    </div>
  </div>
</header>

<div class="wrap grid">
  <!-- 左：名簿 -->
  <div class="card">
    <div class="sec-title">
      <h2>名簿</h2>
      <span class="hint">児童の追加／削除</span>
    </div>

    <div class="row">
      <select id="studentSelect" class="grow"></select>
      <button class="btn" id="btnDeleteStudent" type="button">削除</button>
    </div>

    <div class="row">
      <input id="newStudentName" class="grow" placeholder="追加する児童名（例：山田 太郎）" />
      <button class="btn primary" id="btnAddStudent" type="button">追加</button>
    </div>

    <div class="hr"></div>

    <div class="sec-title">
      <h2>グループ設定（2・2・3）</h2>
      <span class="hint">G1/G2/G3＋未設定</span>
    </div>

    <div class="row">
      <select id="groupSelect" class="grow">
        <option value="">（未設定）</option>
        <option value="G1">G1（2人）</option>
        <option value="G2">G2（2人）</option>
        <option value="G3">G3（3人）</option>
      </select>
      <button class="btn" id="btnAutoGroup" type="button">自動(2・2・3)</button>
    </div>
    <div class="small" id="groupCount" style="margin-top:6px">人数：G1=0 / G2=0 / G3=0（未=0）</div>
  </div>

  <!-- 右：入力 -->
  <div class="card soft">
    <div class="sec-title">
      <h2>記録</h2>
      <span class="hint">提出物・画像は個人（同期しない）</span>
    </div>

    <!-- 画面切替 -->
    <div class="row" style="margin-bottom:10px">
  <button class="btn primary" id="btnViewPersonal" type="button">個人</button>
  <button class="btn" id="btnViewOverview" type="button">一覧</button>

  <!-- ★追加：右から出る一覧パネル -->
  <button class="btn" id="btnToggleSide" type="button">📊 一覧パネル</button>
</div>

    <!-- 個人ビュー -->
    <div id="viewPersonal">
      <!-- 12時間チェック -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div style="font-size:14px;font-weight:700">12時間 進捗チェック</div>
          <span class="badge" id="stepCount">0/12</span>
          <button class="btn" id="btnEditSteps" type="button">内容編集</button>
        </div>

        <div class="small" style="margin-top:8px">※このチェックは「個人管理」（グループ同期しない）</div>

        <div id="stepsWrap" style="display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; margin-top:10px"></div>

<!-- 提出物（提出：済/未）★追加 -->
<div class="card" style="margin-top:12px">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div style="font-size:14px;font-weight:700">提出物（提出：済/未）</div>
    <span class="badge" id="personalAssignBadge">提出：-</span>
  </div>

  <div class="small" style="margin-top:8px">
    ※提出物を選んで「提出：未/済」を切り替えます（児童ごとに保存）
  </div>

  <div class="sub" style="margin-top:10px">提出物を選択</div>
  <div class="row">
    <select id="personalAssignSelect" class="grow"></select>
    <button class="btn" id="btnPersonalPrevAssign" type="button">←</button>
    <button class="btn" id="btnPersonalNextAssign" type="button">→</button>
  </div>

    <div class="small" id="personalAssignStatusText" style="margin-top:10px">---</div>

  <!-- ボタン行だけ -->
  <div class="row" style="margin-top:10px">
    <button class="btn primary" id="btnToggleSubmitted" type="button">提出：未 → 済にする</button>
  </div>

  <!-- メモ -->
  <div class="sub" style="margin-top:12px">提出メモ（提出物ごと）</div>
  <textarea id="personalAssignMemo" placeholder="例：再提出あり／写真OK／期限○日 など"></textarea>

  <!-- 写真 -->
  <div class="sub" style="margin-top:12px">写真（提出物ごと・最大3枚）</div>

  <div class="row">
    <input id="personalAssignPhotoInput" type="file" accept="image/*" />
    <span class="small">※1枚ずつ追加（最大3枚）</span>
  </div>

  <div id="personalAssignPhotoGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px"></div>

  <div class="row" style="margin-top:8px">
    <button class="btn" id="btnClearAssignPhotos" type="button">この提出物の写真を全部削除</button>
  </div>
  </div>
</div>
        
        <!-- ラベル編集パネル -->
        <div class="card" id="stepEditor" style="display:none; margin-top:12px">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div style="font-size:14px;font-weight:700">12時間の内容編集</div>
            <button class="btn" id="btnCloseStepEditor" type="button">閉じる</button>
          </div>

          <div class="sub" style="margin-top:10px">適用先</div>
          <select id="stepApplyScope">
            <option value="current">この児童だけ</option>
            <option value="group">同じグループ</option>
            <option value="all">全員</option>
            <option value="selected">選択した児童だけ</option>
          </select>

          <div id="selectedStudentsBox" style="display:none; margin-top:10px">
            <div class="sub">適用する児童を選択</div>
            <div id="selectedStudentsList" style="display:grid; gap:8px; margin-top:8px"></div>
          </div>

          <div class="row" style="margin-top:10px; gap:10px; flex-wrap:wrap">
            <button class="btn" id="btnLoadGlobalLabels" type="button">共通テンプレを読み込み</button>
            <button class="btn" id="btnSaveGlobalLabels" type="button">共通テンプレとして保存</button>
            <button class="btn primary" id="btnSaveStepLabels" type="button">保存して適用</button>
          </div>

          <div class="sub" style="margin-top:12px">12個の内容</div>
          <div id="stepLabelInputs" style="display:grid; gap:8px; margin-top:8px"></div>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn danger" id="btnClearSteps" type="button">この児童のチェックを全部外す</button>
        </div>
      </div>
    </div>

        <!-- 一覧ビュー -->
    <div id="viewOverview" style="display:none">

      <!-- ① 12時間チェック一覧 -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div style="font-size:14px;font-weight:700">12時間チェック 一覧</div>
          <span class="badge">タップで児童を切替</span>
        </div>
        <div class="small" style="margin-top:8px">
          ※ 行をクリックすると、その児童に切り替わって「個人」に戻ります
        </div>
        <div id="overviewTable" style="margin-top:10px"></div>
      </div>

      <!-- ② 提出物 提出率 一覧 -->
      <div class="card" style="margin-top:12px">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div style="font-size:14px;font-weight:700">提出物 提出率 一覧</div>
          <span class="badge" id="overviewAssignRateBadge">提出率 -/-（-%）</span>
        </div>

        <div class="small" style="margin-top:8px">
          ※提出物を選ぶと、児童ごとの提出状況と提出率を表示します
        </div>

        <div class="sub" style="margin-top:10px">提出物を選択</div>
<div class="row">
  <select id="overviewAssignSelect" class="grow"></select>
  <button class="btn" id="btnOverviewPrevAssign" type="button">←</button>
  <button class="btn" id="btnOverviewNextAssign" type="button">→</button>
</div>

<!-- ★追加：提出物の管理（先生用） -->
<div class="card" style="margin-top:12px">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div style="font-size:13px;font-weight:800">提出物の管理</div>
    <span class="badge">追加・編集・削除</span>
  </div>

  <div class="sub" style="margin-top:10px">新しい提出物を追加</div>
  <div class="row">
    <input id="newAssignTitle" class="grow" placeholder="例：実験レポート①" />
    <button class="btn primary" id="btnAddAssign" type="button">追加</button>
  </div>

  <div class="sub" style="margin-top:12px">提出物一覧（編集/削除）</div>
  <div id="assignManagerList" style="display:grid; gap:8px; margin-top:8px"></div>

  <div class="small" style="margin-top:10px">
    ※提出物を削除すると、その提出物に紐づく提出状況・写真も（今後）削除対象になります
  </div>
</div>
        <div id="overviewAssignTable" style="margin-top:10px"></div>

        <div class="small" style="margin-top:8px">
          ※行をクリックすると、その児童に切り替わって「個人」に戻ります
        </div>
      </div>

    </div><!-- /viewOverview -->

  </div><!-- /右：入力 card soft -->
</div><!-- /wrap grid -->

  <!-- ★追加：右から出るサイドドロワー（進捗＆提出） -->
<div id="sideDrawer" class="drawer" aria-hidden="true">
  <div class="drawerInner">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-weight:800">一覧（進捗 / 提出）</div>
      <button class="btn" id="btnCloseSide" type="button">閉じる</button>
    </div>

    <div class="hr"></div>

    <!-- 12時間チェック（サイド） -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:13px;font-weight:800">12時間チェック 一覧</div>
        <span class="badge">タップで切替</span>
      </div>
      <div id="sideOverviewSteps" style="margin-top:10px"></div>
    </div>

    <!-- 提出率（サイド） -->
    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:13px;font-weight:800">提出物 提出率</div>
        <span class="badge" id="sideOverviewAssignRateBadge">提出率 -/-（-%）</span>
      </div>

      <div class="sub" style="margin-top:10px">提出物を選択</div>
      <div class="row">
        <select id="sideOverviewAssignSelect" class="grow"></select>
        <button class="btn" id="btnSideOverviewPrevAssign" type="button">←</button>
        <button class="btn" id="btnSideOverviewNextAssign" type="button">→</button>
      </div>

      <div id="sideOverviewAssignTable" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<!-- ★追加：背景オーバーレイ -->
<div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>
  
<script src="./app.js" defer></script>
</body>
</html>
