<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>4年理科 評価記録ツール（冬プロ）</title>
  <link rel="stylesheet" href="./styles.css?v=20260122a" />
</head>

<body>
<header>
  <div class="wrap">
    <div class="headerBar">
      <div class="headerLeft">
        <h1>4年理科 評価記録ツール（冬の自然探究プロジェクト）</h1>
        <div class="sub">localStorageのみ（オフライン）</div>
      </div>

      <div class="headerActions">
        <button class="btn" id="btnTheme" type="button">🌙</button>
        <button class="btn" id="btnOpenRoster" type="button">名簿設定</button>
        <button class="btn" id="btnOpenAssign" type="button">提出物設定</button>
        <button class="btn" id="btnBackMain" type="button" style="display:none">←戻る</button>
        <button class="btn" id="btnExport" type="button">エクスポート</button>
        <button class="btn" id="btnImport" type="button">インポート</button>
        <button class="btn danger" id="btnReset" type="button">全データ削除</button>
      </div>
    </div>
  </div>
</header>

<div id="screenMain">
<div class="wrap grid">
  
  <!-- ★左：児童選択（ミニ） -->
<div class="card">
  <div class="sec-title">
    <h2>児童</h2>
    <span class="hint">記録する児童を切替</span>
  </div>

  <div class="row">
    <select id="mainStudentSelect" class="grow"></select>
  </div>

  <div class="small" style="margin-top:8px">
    ※名簿の追加・削除・グループ設定は「名簿設定」から行います
  </div>
</div>

  <!-- 右：入力 -->
  <div class="card soft">
    <div class="sec-title">
      <h2>記録</h2>
      <span class="hint">提出物・画像は個人（同期しない）</span>
    </div>
    <!-- 画面切替 -->
    <div class="row" style="margin-bottom:10px">
  <button class="btn primary" id="btnViewPersonal" type="button">個人</button>
  <button class="btn" id="btnViewOverview" type="button">一覧</button>

  <!-- ★追加：右から出る一覧パネル -->
  <button class="btn" id="btnToggleSide" type="button">📊 一覧パネル</button>
</div>

   <!-- 個人ビュー -->
<div id="viewPersonal">
  <!-- 12時間チェック -->
  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-size:14px;font-weight:700">12時間 進捗チェック</div>
      <span class="badge" id="stepCount">0/12</span>
      <button class="btn" id="btnEditSteps" type="button">内容編集</button>
    </div>

    <div class="small" style="margin-top:8px">※このチェックは「個人管理」（グループ同期しない）</div>
    <div id="stepsWrap" style="display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; margin-top:10px"></div>
<!-- ▼個人ビュー：提出物（B） -->
<section class="card" id="personalAssignCard">
  <div class="sec-title">
    <h2>提出物（個人）</h2>
    <div class="row" style="gap:8px">
      <span class="badge" id="personalAssignTitleBadge">—</span>
    </div>
  </div>

  <div class="row" style="align-items:center">
    <select id="personalAssignSelect" class="grow"></select>

    <button type="button" class="btn" id="btnPersonalPrevAssign">◀</button>
    <button type="button" class="btn" id="btnPersonalNextAssign">▶</button>

    <button type="button" class="btn primary" id="btnPersonalToggleSubmitted">提出：未</button>
  </div>

  <div class="hr"></div>

  <div class="grid" style="grid-template-columns: 1fr; gap:10px">
    <div>
      <div class="sub">メモ</div>
      <textarea id="personalAssignMemo" placeholder="気づいたこと / 返却状況など"></textarea>
    </div>

    <div>
      <div class="sub">写真（最大3枚）</div>
      <div class="row"
     style="gap:10px; align-items:flex-start; flex-wrap:wrap"
     id="personalPhotoRow"></div>
      <div class="hint">※端末内保存（localStorage）なので、写真を増やしすぎると容量上限に達します</div>
    </div>
  </div>
</section>
    <!-- 提出物（提出：済/未） -->
<div class="card" style="margin-top:12px">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div style="font-size:14px;font-weight:700">提出物（一覧）</div>
    <span class="badge" id="personalAssignRateBadge">提出率 -/-（-%）</span>
  </div>

  <div class="small" style="margin-top:8px">
    ※各提出物ごとに「提出：未/済」「メモ」「写真（最大3枚）」を記録できます
  </div>

  <!-- ★ここに提出物カードをJSで全部描画する -->
  <div id="personalAssignmentsWrap" style="display:grid; gap:10px; margin-top:10px"></div>
</div><!-- /提出物 card -->

    <!-- ラベル編集パネル -->
    <div class="card" id="stepEditor" style="display:none; margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:14px;font-weight:700">12時間の内容編集</div>
        <button class="btn" id="btnCloseStepEditor" type="button">閉じる</button>
      </div>

      <div class="sub" style="margin-top:10px">適用先</div>
      <select id="stepApplyScope">
        <option value="current">この児童だけ</option>
        <option value="group">同じグループ</option>
        <option value="all">全員</option>
        <option value="selected">選択した児童だけ</option>
      </select>

      <div id="selectedStudentsBox" style="display:none; margin-top:10px">
        <div class="sub">適用する児童を選択</div>
        <div id="selectedStudentsList" style="display:grid; gap:8px; margin-top:8px"></div>
      </div>

      <div class="row" style="margin-top:10px; gap:10px; flex-wrap:wrap">
        <button class="btn" id="btnLoadGlobalLabels" type="button">共通テンプレを読み込み</button>
        <button class="btn" id="btnSaveGlobalLabels" type="button">共通テンプレとして保存</button>
        <button class="btn primary" id="btnSaveStepLabels" type="button">保存して適用</button>
      </div>

      <div class="sub" style="margin-top:12px">12個の内容</div>
      <div id="stepLabelInputs" style="display:grid; gap:8px; margin-top:8px"></div>
    </div><!-- /stepEditor -->

    <div class="row" style="margin-top:10px">
      <button class="btn danger" id="btnClearSteps" type="button">この児童のチェックを全部外す</button>
    </div>
  </div><!-- /12時間 card -->
</div><!-- /viewPersonal -->
        <!-- 一覧ビュー -->
    <div id="viewOverview" style="display:none">

      <!-- ① 12時間チェック一覧 -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div style="font-size:14px;font-weight:700">12時間チェック 一覧</div>
          <span class="badge">タップで児童を切替</span>
        </div>
        <div class="small" style="margin-top:8px">
          ※ 行をクリックすると、その児童に切り替わって「個人」に戻ります
        </div>
        <div id="overviewTable" style="margin-top:10px"></div>
      </div>

      <!-- ② 提出物 提出率 一覧 -->
      <div class="card" style="margin-top:12px">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div style="font-size:14px;font-weight:700">提出物 提出率 一覧</div>
          <span class="badge" id="overviewAssignRateBadge">提出率 -/-（-%）</span>
        </div>

        <div class="small" style="margin-top:8px">
          ※提出物を選ぶと、児童ごとの提出状況と提出率を表示します
        </div>

        <div class="sub" style="margin-top:10px">提出物を選択</div>
<div class="row">
  <select id="overviewAssignSelect" class="grow"></select>
</div>

        <div id="overviewAssignTable" style="margin-top:10px"></div>

        <div class="small" style="margin-top:8px">
          ※行をクリックすると、その児童に切り替わって「個人」に戻ります
        </div>
      </div>

    </div><!-- /viewOverview -->

  </div><!-- /右：入力 card soft -->
</div><!-- /wrap grid -->
</div><!-- /screenMain -->
  <!-- ★追加：右から出るサイドドロワー（進捗＆提出） -->
<div id="sideDrawer" class="drawer" aria-hidden="true">
  <div class="drawerInner">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-weight:800">一覧（進捗 / 提出）</div>
      <button class="btn" id="btnCloseSide" type="button">閉じる</button>
    </div>

    <div class="hr"></div>

    <!-- 12時間チェック（サイド） -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:13px;font-weight:800">12時間チェック 一覧</div>
        <span class="badge">タップで切替</span>
      </div>
      <div id="sideOverviewSteps" style="margin-top:10px"></div>
    </div>

    <!-- 提出率（サイド） -->
    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:13px;font-weight:800">提出物 提出率</div>
        <span class="badge" id="sideOverviewAssignRateBadge">提出率 -/-（-%）</span>
      </div>

      <div class="sub" style="margin-top:10px">提出物を選択</div>
      <div class="row">
        <select id="sideOverviewAssignSelect" class="grow"></select>
      </div>

      <div id="sideOverviewAssignTable" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<!-- ★追加：背景オーバーレイ -->
<div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>

<!-- ===================================================
     ★追加：名簿設定 画面
=================================================== -->
<div id="screenRoster" style="display:none">
    <div class="wrap">
      <div class="card">
        <div class="sec-title">
          <h2>名簿設定</h2>
          <span class="hint">追加・削除・グループ割り当て</span>
        </div>
        <div id="rosterScreenBody" class="small">
  <div class="card">
    <div class="sec-title">
      <h2>名簿</h2>
      <span class="hint">児童の追加／削除</span>
    </div>

    <div class="row">
      <!-- roster側は別IDにする（mainと重複防止） -->
      <select id="rosterStudentSelect" class="grow"></select>
      <button class="btn" id="btnDeleteStudent" type="button">削除</button>
    </div>

    <div class="row">
      <input id="newStudentName" class="grow" placeholder="追加する児童名（例：山田 太郎）" />
      <button class="btn primary" id="btnAddStudent" type="button">追加</button>
    </div>

    <div class="hr"></div>

    <div class="sec-title">
      <h2>グループ設定（2・2・3）</h2>
      <span class="hint">G1/G2/G3＋未設定</span>
    </div>

    <div class="row">
      <select id="groupSelect" class="grow">
        <option value="">（未設定）</option>
        <option value="G1">G1（2人）</option>
        <option value="G2">G2（2人）</option>
        <option value="G3">G3（3人）</option>
      </select>
      <button class="btn" id="btnAutoGroup" type="button">自動(2・2・3)</button>
    </div>

    <div class="small" id="groupCount" style="margin-top:6px">
      人数：G1=0 / G2=0 / G3=0（未=0）
    </div>
  </div>
</div>
        </div>
      </div>
    </div>
</div>

<!-- ===================================================
     ★追加：提出物設定 画面
=================================================== -->
<div id="screenAssignments" style="display:none">
    <div class="wrap">
      <div class="card">
        <div class="sec-title">
          <h2>提出物設定</h2>
          <span class="hint">提出物の追加・編集・削除</span>
        </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-size:14px;font-weight:800">提出物の管理</div>
      <span class="badge">追加・編集・削除</span>
    </div>

    <div class="sub" style="margin-top:12px">新しい提出物を追加</div>
    <div class="row">
      <input id="newAssignTitle" class="grow" placeholder="例：実験レポート①" />
      <button class="btn primary" id="btnAddAssign" type="button">追加</button>
    </div>

    <div class="sub" style="margin-top:12px">提出物一覧（編集 / 削除）</div>
    <div id="assignManagerList" style="display:grid; gap:8px; margin-top:8px"></div>

    <div class="small" style="margin-top:10px">
      ※ここで追加・削除した提出物は、個人画面・一覧画面に自動で反映されます
    </div>
  </div>

</div>
        </div>
      </div>
    </div>
</div>
  
<script src="./app.js?v=20260122a" defer></script>
</body>
</html>
