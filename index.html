<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>4å¹´ç†ç§‘ è©•ä¾¡è¨˜éŒ²ãƒ„ãƒ¼ãƒ«ï¼ˆå†¬ãƒ—ãƒ­ï¼‰</title>

  <style>
    /* 12æ™‚é–“ãƒã‚§ãƒƒã‚¯ã®è¦‹ãŸç›® */
.stepBtn{
  background: var(--card2);
  border: 1px solid var(--line);
  color: var(--text);
  font-weight: 700;
}
.stepBtn.isDone{
  background: var(--accent);
  border-color: var(--accent);
  color: #08121f; /* æ˜ã‚‹ã„èƒŒæ™¯ã§æ–‡å­—ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ï¼ˆå›ºå®šè‰²ã§OKãªã‚‰ï¼‰ */
}
:root[data-theme="light"] .stepBtn.isDone{
  color: #07121f;
}
    :root{
      --bg:#0b0c10; --card:#12141a; --card2:#161a22; --text:#e8eef7; --muted:#a9b3c2;
      --line:#232a36; --chip:#1c2330; --btn:#1f2a3a; --accent:#59a8ff;
      --danger:#ff6b6b;
    }
    :root[data-theme="light"]{
      --bg:#f6f7fb; --card:#ffffff; --card2:#f1f3f8; --text:#0c1220; --muted:#4b5565;
      --line:#d9e0ea; --chip:#eef2f8; --btn:#ffffff;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }

    header{
      position:sticky; top:0; z-index:1000;
      background: color-mix(in srgb, var(--bg) 88%, transparent);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    :root[data-theme="light"] header{
      background:rgba(255,255,255,.92);
    }

    .wrap{max-width:1250px;margin:0 auto;padding:14px 14px 22px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grid{display:grid;gap:12px}
    @media (min-width: 920px){ .grid{grid-template-columns: 360px 1fr} }

    .grow{flex:1; min-width:0}
    h1{font-size:16px;margin:0 0 6px 0;letter-spacing:.02em}
    .sub{font-size:12px;color:var(--muted)}
    .hint{font-size:12px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .hr{height:1px;background:var(--line);margin:10px 0}

    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px}
    .card.soft{background:var(--card2)}
    .sec-title{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;margin-bottom:8px}
    .sec-title h2{font-size:14px;margin:0}

    .btn{
      background:var(--btn);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      cursor:pointer;
      pointer-events:auto;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{border-color: color-mix(in srgb, var(--line) 40%, #ffffff 30%)}
    .btn.primary{border-color: color-mix(in srgb, var(--accent) 60%, var(--line));}
    .btn.danger{border-color: color-mix(in srgb, var(--danger) 65%, var(--line)); color: color-mix(in srgb, var(--danger) 70%, var(--text));}

    input,select,textarea{
      background:var(--card2);
      border:1px solid var(--line);
      color:var(--text);
      border-radius:10px;
      padding:10px;
      font-size:13px;
      width:100%;
      min-width:0;
    }
    textarea{min-height:84px; resize:vertical}

    /* iPadæ¨ªã§ header ãŒ â€œã‹ã¶ã•ã£ã¦ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ãªã„â€ å¯¾ç­– */
    .headerBar{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
      position:relative;
      z-index:2000;
    }
    .headerLeft{flex:1 1 auto; min-width:0}
    .headerLeft h1{overflow-wrap:anywhere}
    .headerActions{flex:0 0 auto; display:flex; gap:10px; flex-wrap:wrap; z-index:3000}
    #btnTheme{position:relative; z-index:4000; pointer-events:auto}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      background:var(--chip); color:var(--muted); font-size:12px;
    }
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding:2px 8px; border-radius:999px; border:1px solid var(--line);
      background:var(--chip); color:var(--muted); font-size:12px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="headerBar">
      <div class="headerLeft">
        <h1>4å¹´ç†ç§‘ è©•ä¾¡è¨˜éŒ²ãƒ„ãƒ¼ãƒ«ï¼ˆå†¬ã®è‡ªç„¶æ¢ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰</h1>
        <div class="sub">localStorageã®ã¿ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰</div>
      </div>

      <div class="headerActions">
        <button class="btn" id="btnTheme" type="button">ğŸŒ™</button>
        <button class="btn" id="btnExport" type="button">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button class="btn" id="btnImport" type="button">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <button class="btn danger" id="btnReset" type="button">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
      </div>
    </div>
  </div>
</header>

<div class="wrap grid">
  <!-- å·¦ï¼šåç°¿ -->
  <div class="card">
    <div class="sec-title">
      <h2>åç°¿</h2>
      <span class="hint">å…ç«¥ã®è¿½åŠ ï¼å‰Šé™¤ï¼ˆPart2ã§å®Ÿè£…ï¼‰</span>
    </div>

    <div class="row">
      <select id="studentSelect" class="grow">
        <option value="(sample)">ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥A</option>
      </select>
      <button class="btn" id="btnDeleteStudent" type="button">å‰Šé™¤</button>
    </div>

    <div class="row">
      <input id="newStudentName" class="grow" placeholder="è¿½åŠ ã™ã‚‹å…ç«¥åï¼ˆä¾‹ï¼šå±±ç”° å¤ªéƒï¼‰" />
      <button class="btn primary" id="btnAddStudent" type="button">è¿½åŠ </button>
    </div>

    <div class="hr"></div>

    <div class="sec-title">
      <h2>ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šï¼ˆ2ãƒ»2ãƒ»3ï¼‰</h2>
      <span class="hint">G1/G2/G3ï¼‹æœªè¨­å®š</span>
    </div>

    <div class="row">
      <select id="groupSelect" class="grow">
        <option value="">ï¼ˆæœªè¨­å®šï¼‰</option>
        <option value="G1">G1ï¼ˆ2äººï¼‰</option>
        <option value="G2">G2ï¼ˆ2äººï¼‰</option>
        <option value="G3">G3ï¼ˆ3äººï¼‰</option>
      </select>
      <button class="btn" id="btnAutoGroup" type="button">è‡ªå‹•(2ãƒ»2ãƒ»3)</button>
    </div>
    <div class="small" id="groupCount" style="margin-top:6px">
      äººæ•°ï¼šG1=0 / G2=0 / G3=0ï¼ˆæœª=0ï¼‰
    </div>
  </div>

  <!-- å³ï¼šå…¥åŠ›ã‚¨ãƒªã‚¢ -->
  <div class="card soft">
    <div class="sec-title">
      <h2>è¨˜éŒ²</h2>
      <span class="hint">æå‡ºç‰©ãƒ»ç”»åƒã¯å€‹äººï¼ˆåŒæœŸã—ãªã„ï¼‰</span>
    </div>
<!-- â˜… ç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼ˆå€‹äºº / ä¸€è¦§ï¼‰ -->
<div class="row" style="margin-bottom:10px">
  <button class="btn primary" id="btnViewPersonal" type="button">å€‹äºº</button>
  <button class="btn" id="btnViewOverview" type="button">ä¸€è¦§</button>
</div>

<!-- â˜… å€‹äººãƒ“ãƒ¥ãƒ¼ï¼ˆä»Šã¾ã§ã®ä¸­èº«ã‚’å…¨éƒ¨ã“ã“ã«å…¥ã‚Œã‚‹ï¼‰ -->
<div id="viewPersonal">

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-size:14px;font-weight:700">è¨ˆç”»ï¼ˆplanï¼‰ï¼é€²æ—ï¼ˆstatusï¼‰</div>
      <span class="badge">åŒæœŸå¯¾è±¡</span>
    </div>

    <!-- â˜… 12æ™‚é–“ é€²æ—ãƒã‚§ãƒƒã‚¯ï¼ˆå€‹äººï¼‰ -->
    <div class="card" style="margin-top:12px">
      ï¼ˆä¸­èº«ãã®ã¾ã¾ï¼‰
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    ï¼ˆæå‡ºç‰©ãƒ»ç”»åƒã®ä¸­èº«ãã®ã¾ã¾ï¼‰
  </div>

  <div class="card" style="margin-top:12px">
    ï¼ˆã“ã®æ®µéšã®ç¢ºèª ãã®ã¾ã¾ï¼‰
  </div>

</div>

<!-- â˜… ä¸€è¦§ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
<div id="viewOverview" style="display:none">
  ï¼ˆä¸€è¦§ã®ä¸­èº«ãã®ã¾ã¾ï¼‰
</div>

    <!-- â˜… 12æ™‚é–“ é€²æ—ãƒã‚§ãƒƒã‚¯ï¼ˆå€‹äººï¼‰ -->
    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:14px;font-weight:700">12æ™‚é–“ é€²æ—ãƒã‚§ãƒƒã‚¯</div>
        <span class="badge" id="stepCount">0/12</span>
        <button class="btn" id="btnEditSteps" type="button">å†…å®¹ç·¨é›†</button>
      </div>

      <div class="small" style="margin-top:8px">
        â€»ã“ã®ãƒã‚§ãƒƒã‚¯ã¯ã€Œå€‹äººç®¡ç†ã€ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åŒæœŸã—ãªã„ï¼‰
      </div>

      <div id="stepsWrap" style="display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; margin-top:10px">
        <!-- JSã§ 1ã€œ12 ã‚’ç”Ÿæˆ -->
      </div>
 <!-- â–¼ 12æ™‚é–“ãƒ©ãƒ™ãƒ«ç·¨é›†ãƒ‘ãƒãƒ«ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
 <div class="card" id="stepEditor" style="display:none; margin-top:12px">
   <div class="row" style="justify-content:space-between;align-items:center">
     <div style="font-size:14px;font-weight:700">12æ™‚é–“ã®å†…å®¹ç·¨é›†</div>
     <button class="btn" id="btnCloseStepEditor" type="button">é–‰ã˜ã‚‹</button>
   </div>

   <div class="sub" style="margin-top:10px">é©ç”¨å…ˆ</div>
   <select id="stepApplyScope">
     <option value="current">ã“ã®å…ç«¥ã ã‘</option>
     <option value="group">åŒã˜ã‚°ãƒ«ãƒ¼ãƒ—</option>
     <option value="all">å…¨å“¡</option>
     <option value="selected">é¸æŠã—ãŸå…ç«¥ã ã‘</option>
   </select>

  <div id="selectedStudentsBox" style="display:none; margin-top:10px">
    <div class="sub">é©ç”¨ã™ã‚‹å…ç«¥ã‚’é¸æŠ</div>
    <div id="selectedStudentsList" style="display:grid; gap:8px; margin-top:8px"></div>
   </div>

   <div class="row" style="margin-top:10px; gap:10px; flex-wrap:wrap">
  <button class="btn" id="btnLoadGlobalLabels" type="button">å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã‚’èª­ã¿è¾¼ã¿</button>
  <button class="btn" id="btnSaveGlobalLabels" type="button">å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã¨ã—ã¦ä¿å­˜</button> <!-- â˜…è¿½åŠ  -->
  <button class="btn primary" id="btnSaveStepLabels" type="button">ä¿å­˜ã—ã¦é©ç”¨</button>
</div>

   <div class="sub" style="margin-top:12px">12å€‹ã®å†…å®¹</div>
   <div id="stepLabelInputs" style="display:grid; gap:8px; margin-top:8px"></div>
 </div>
 <!-- â–² ç·¨é›†ãƒ‘ãƒãƒ«ã“ã“ã¾ã§ -->
      <div class="row" style="margin-top:10px">
        <button class="btn danger" id="btnClearSteps" type="button">ã“ã®å…ç«¥ã®ãƒã‚§ãƒƒã‚¯ã‚’å…¨éƒ¨å¤–ã™</button>
      </div>
    </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:14px;font-weight:700">æå‡ºç‰©ãƒ»ç”»åƒï¼ˆå€‹äººï¼‰</div>
        <span class="badge">åŒæœŸã—ãªã„</span>
      </div>

      <div class="sub" style="margin-top:10px">æå‡ºç‰©ãƒ¡ãƒ¢ï¼ˆå€‹äººï¼‰</div>
      <textarea id="noteInput" placeholder="ä¾‹ï¼šæå‡ºæ¸ˆã¿ã€å†æå‡ºã€å†™çœŸOK ãªã©ï¼ˆå€‹äººãƒ¡ãƒ¢ï¼‰"></textarea>

      <div class="sub" style="margin-top:10px">ç”»åƒï¼ˆå€‹äººãƒ»1æšï¼‰</div>
      <div class="row">
        <input id="photoInput" type="file" accept="image/*" />
        <button class="btn" id="btnClearPhoto" type="button">ç”»åƒã‚’å‰Šé™¤</button>
      </div>

      <img id="photoPreview" alt="" style="width:100%;max-height:320px;object-fit:contain;border:1px solid var(--line);border-radius:12px;display:none;margin-top:8px" />
      <div class="small" style="margin-top:8px">â€»ç”»åƒã¯ç«¯æœ«å†…ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆlocalStorageï¼‰ã€‚åŒæœŸã¯ã—ã¾ã›ã‚“ã€‚</div>
    </div>

    <div class="card" style="margin-top:12px">
      <div style="font-size:14px;font-weight:700;margin-bottom:6px">ã“ã®æ®µéšã®ç¢ºèª</div>
      <ul style="margin:0; padding-left:18px; color:var(--muted); line-height:1.7; font-size:13px">
        <li>å³ä¸Šã®ğŸŒ™/â˜€ï¸ã§ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹</li>
        <li>iPadæ¨ªã§ã‚‚å³ä¸Šãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã‚‹ï¼ˆheaderãŒã‹ã¶ã‚‰ãªã„ï¼‰</li>
        <li>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„</li>
      </ul>
    </div>
  </div>
</div>

<script>
/**********************
 * Part2: localStorage + roster/group/sync + personal(note/photo) + steps(12)
 **********************/

// ===== Storage keys =====
const THEME_KEY = "rika4_theme_v3";
const DATA_KEY  = "rika4_evaltool_v1";

// ===== Theme =====
function applyTheme(mode){
  document.documentElement.dataset.theme = mode;
  localStorage.setItem(THEME_KEY, mode);

  const btn = document.getElementById("btnTheme");
  if(btn){
    btn.textContent = (mode === "light") ? "â˜€ï¸" : "ğŸŒ™";
    btn.title = (mode === "light") ? "ãƒ€ãƒ¼ã‚¯ã«åˆ‡ã‚Šæ›¿ãˆ" : "ãƒ©ã‚¤ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ";
  }
}
function toggleTheme(){
  const cur = document.documentElement.dataset.theme || "dark";
  applyTheme(cur === "dark" ? "light" : "dark");
}

// ===== Data model =====
const defaultData = {
  students: [
  "ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥A","ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥B","ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥C",
  "ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥D","ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥E","ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥F","ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰å…ç«¥G"
],
  studentGroup: {},
  
  noteByStudent: {},
  photosByStudent: {},
  stepsByStudent: {},

  stepLabelsGlobal: [
    "èª¿ã¹ã‚‹â‘ ","èª¿ã¹ã‚‹â‘¡","èª¿ã¹ã‚‹â‘¢",
    "ã¾ã¨ã‚ã‚‹â‘ ","ã¾ã¨ã‚ã‚‹â‘¡","ã¾ã¨ã‚ã‚‹â‘¢",
    "ç™ºè¡¨â‘ ","ç™ºè¡¨â‘¡","ç™ºè¡¨â‘¢",
    "ãµã‚Šè¿”ã‚Šâ‘ ","ãµã‚Šè¿”ã‚Šâ‘¡","ãµã‚Šè¿”ã‚Šâ‘¢"
  ],
  stepLabelsByStudent: {}
};

function safeClone(obj){
  return JSON.parse(JSON.stringify(obj));
}

function loadData(){
  try{
    const raw = localStorage.getItem(DATA_KEY);
    const d = raw ? JSON.parse(raw) : safeClone(defaultData);

    if(!Array.isArray(d.students)) d.students = safeClone(defaultData.students);
if(!d.studentGroup || typeof d.studentGroup !== "object") d.studentGroup = {};
if(!d.progressByStudent || typeof d.progressByStudent !== "object") d.progressByStudent = {};
if(!d.noteByStudent || typeof d.noteByStudent !== "object") d.noteByStudent = {};
if(!d.photosByStudent || typeof d.photosByStudent !== "object") d.photosByStudent = {};
if(!d.stepsByStudent || typeof d.stepsByStudent !== "object") d.stepsByStudent = {};

// â˜… è¿½åŠ ï¼šstepãƒ©ãƒ™ãƒ«ã®ä¿å­˜é ˜åŸŸã‚’è£œå®Œ
if(!Array.isArray(d.stepLabelsGlobal) || d.stepLabelsGlobal.length !== 12){
  d.stepLabelsGlobal = safeClone(defaultData.stepLabelsGlobal);
}
if(!d.stepLabelsByStudent || typeof d.stepLabelsByStudent !== "object"){
  d.stepLabelsByStudent = {};
}
    // å…ç«¥ã”ã¨ã®ä¸è¶³ã‚’è£œå®Œ
    d.students.forEach(name=>{
      if(d.studentGroup[name] == null) d.studentGroup[name] = "";

      if(d.progressByStudent[name] == null) d.progressByStudent[name] = { plan:"", status:"" };
      else{
        if(d.progressByStudent[name].plan == null) d.progressByStudent[name].plan = "";
        if(d.progressByStudent[name].status == null) d.progressByStudent[name].status = "";
      }

      if(d.noteByStudent[name] == null) d.noteByStudent[name] = "";
      if(d.photosByStudent[name] == null) d.photosByStudent[name] = "";

      if(!Array.isArray(d.stepsByStudent[name]) || d.stepsByStudent[name].length !== 12){
        d.stepsByStudent[name] = Array.from({length:12}, ()=> false);
      }
    });

    if(d.students.length === 0){
      d.students = ["å…ç«¥1"];
      d.studentGroup["å…ç«¥1"] = "";
      d.progressByStudent["å…ç«¥1"] = { plan:"", status:"" };
      d.noteByStudent["å…ç«¥1"] = "";
      d.photosByStudent["å…ç«¥1"] = "";
      d.stepsByStudent["å…ç«¥1"] = Array.from({length:12}, ()=> false);
    }

    return d;
  }catch(e){
    console.warn("loadData error:", e);
    return safeClone(defaultData);
  }
}

function saveData(){
  localStorage.setItem(DATA_KEY, JSON.stringify(state.data));
}

const state = {
  data: loadData(),
  currentStudent: null
};

// ===== View switch (personal / overview) =====
function setView(mode){
  const personal = document.getElementById("viewPersonal");
  const overview = document.getElementById("viewOverview");
  const bP = document.getElementById("btnViewPersonal");
  const bO = document.getElementById("btnViewOverview");
  if(!personal || !overview || !bP || !bO) return;

  const isOverview = (mode === "overview");
  personal.style.display = isOverview ? "none" : "block";
  overview.style.display = isOverview ? "block" : "none";

  bP.classList.toggle("primary", !isOverview);
  bO.classList.toggle("primary", isOverview);

  if(isOverview){
    renderOverview(); // ä¸€è¦§ã‚’æç”»
  }
}

function bindViewButtons(){
  const bP = document.getElementById("btnViewPersonal");
  const bO = document.getElementById("btnViewOverview");
  if(bP) bP.onclick = ()=> setView("personal");
  if(bO) bO.onclick = ()=> setView("overview");
}

function renderOverview(){
  const host = document.getElementById("overviewTable");
  if(!host) return;

  // ãƒ†ãƒ¼ãƒ–ãƒ«ã£ã½ã„è¦‹ãŸç›®ï¼ˆdivã§ä½œã‚‹ï¼‰
  const wrap = document.createElement("div");
  wrap.style.display = "grid";
  wrap.style.gap = "8px";

  state.data.students.forEach(name=>{
    ensureStudent(name);
    const arr = state.data.stepsByStudent[name] || [];
    const done = arr.filter(Boolean).length;

    const row = document.createElement("button");
    row.type = "button";
    row.className = "btn";
    row.style.textAlign = "left";
    row.style.display = "grid";
    row.style.gridTemplateColumns = "1fr auto";
    row.style.alignItems = "center";
    row.style.gap = "10px";
    row.style.padding = "12px";

    const left = document.createElement("div");
    left.innerHTML = `
      <div style="font-weight:800">${name}</div>
      <div style="font-size:12px;color:var(--muted);margin-top:2px">
        ${done}/12 å®Œäº†
      </div>
    `;

    const right = document.createElement("div");
    right.className = "badge";
    right.textContent = `${done}/12`;

    // è¡Œã‚¯ãƒªãƒƒã‚¯ã§ãã®å…ç«¥ã¸åˆ‡æ›¿ â†’ å€‹äººã¸æˆ»ã‚‹
    row.onclick = ()=>{
      state.currentStudent = name;
      saveData();
      renderStudentSelect();
      renderGroupUI();
      renderSteps();
      // æå‡ºç‰©ã‚‚å¾Œã§ã“ã“ã§renderã™ã‚‹
      setView("personal");
    };

    row.appendChild(left);
    row.appendChild(right);
    wrap.appendChild(row);
  });

  host.innerHTML = "";
  host.appendChild(wrap);
}
  
  
// ===== Helpers =====
function ensureStudent(name){
  if(state.data.studentGroup[name] == null) state.data.studentGroup[name] = "";
  if(state.data.noteByStudent[name] == null) state.data.noteByStudent[name] = "";
  if(state.data.photosByStudent[name] == null) state.data.photosByStudent[name] = "";
  if(!state.data.stepsByStudent) state.data.stepsByStudent = {};
  if(!Array.isArray(state.data.stepsByStudent[name]) || state.data.stepsByStudent[name].length !== 12){
    state.data.stepsByStudent[name] = Array.from({length:12}, ()=> false);
  }
  if(!state.data.progressByStudent) state.data.progressByStudent = {};
if(!state.data.progressByStudent[name]) state.data.progressByStudent[name] = { plan:"", status:"" };
}

function getGroupMembers(studentName){
  const g = (state.data.studentGroup && state.data.studentGroup[studentName]) || "";
  if(!g) return [studentName];
  return state.data.students.filter(n => ((state.data.studentGroup && state.data.studentGroup[n]) || "") === g);
}

// ===== UI: student select =====
function renderStudentSelect(){
  const sel = document.getElementById("studentSelect");
  if(!sel) return;

  sel.innerHTML = "";
  state.data.students.forEach(name=>{
    const o = document.createElement("option");
    o.value = name;
    o.textContent = name;
    sel.appendChild(o);
  });

  if(!state.currentStudent) state.currentStudent = state.data.students[0];
  if(!state.data.students.includes(state.currentStudent)) state.currentStudent = state.data.students[0];
  sel.value = state.currentStudent;

  sel.onchange = ()=>{
    state.currentStudent = sel.value;
    renderGroupUI();
    renderSteps();
    saveData();
  };
}

// ===== UI: group =====
function renderGroupUI(){
  const sel = document.getElementById("groupSelect");
  const cnt = document.getElementById("groupCount");
  if(!sel || !cnt) return;

  ensureStudent(state.currentStudent);

  const g = (state.data.studentGroup && state.data.studentGroup[state.currentStudent]) || "";
  sel.value = g;

  const counts = {G1:0, G2:0, G3:0, "":0};
  state.data.students.forEach(n=>{
    const gg = (state.data.studentGroup && state.data.studentGroup[n]) || "";
    counts[gg] = (counts[gg] ?? 0) + 1;
  });

  cnt.textContent = `äººæ•°ï¼šG1=${counts.G1} / G2=${counts.G2} / G3=${counts.G3}ï¼ˆæœª=${counts[""]}ï¼‰`;

  sel.onchange = ()=>{
    if(!state.data.studentGroup) state.data.studentGroup = {};
    state.data.studentGroup[state.currentStudent] = sel.value;
    saveData();
    renderGroupUI();
  };
}

function autoAssignGroups223(){
  const list = state.data.students.slice();
  const plan = ["G1","G1","G2","G2","G3","G3","G3"];
  if(!state.data.studentGroup) state.data.studentGroup = {};
  list.forEach((n,i)=>{
    state.data.studentGroup[n] = plan[i] || "G3";
  });
  saveData();
  renderGroupUI();
}

/**********************
 * 12æ™‚é–“ãƒã‚§ãƒƒã‚¯ï¼ˆå€‹äººãƒ»åŒæœŸã—ãªã„ï¼‰
 **********************/
function updateStepCount(){
  const badge = document.getElementById("stepCount");
  if(!badge) return;

  ensureStudent(state.currentStudent);
  const arr = state.data.stepsByStudent[state.currentStudent] || [];
  const done = arr.filter(Boolean).length;
  badge.textContent = `${done}/12`;
}
function getStepLabelsFor(studentName){
  // å…ç«¥ã®ä¸Šæ›¸ããŒã‚ã‚Œã°ãã‚Œã‚’ã€ãªã‘ã‚Œã°å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã‚’è¿”ã™
  const per = state.data.stepLabelsByStudent && state.data.stepLabelsByStudent[studentName];
  if(Array.isArray(per) && per.length === 12) return per;
  return state.data.stepLabelsGlobal || safeClone(defaultData.stepLabelsGlobal);
}

function renderStepLabelInputs(labels){
  const box = document.getElementById("stepLabelInputs");
  if(!box) return;
  box.innerHTML = "";

  for(let i=0;i<12;i++){
    const wrap = document.createElement("div");
    wrap.className = "card";
    wrap.style.padding = "10px";

    const t = document.createElement("div");
    t.className = "sub";
    t.textContent = `${i+1}ç•ª`;

    const inp = document.createElement("input");
    inp.type = "text";
    inp.value = labels[i] || "";
    inp.dataset.idx = String(i);

    wrap.appendChild(t);
    wrap.appendChild(inp);
    box.appendChild(wrap);
  }
}

function readStepLabelInputs(){
  const box = document.getElementById("stepLabelInputs");
  const inputs = box ? Array.from(box.querySelectorAll("input")) : [];
  const arr = Array.from({length:12}, ()=> "");

  inputs.forEach(inp=>{
    const idx = Number(inp.dataset.idx);
    if(!Number.isNaN(idx) && idx>=0 && idx<12){
      arr[idx] = (inp.value || "").trim();
    }
  });

  // ç©ºæ¬„ã§ã‚‚OKã ãŒã€å®Œå…¨ç©ºç™½ã¯è¦‹ã¥ã‚‰ã„ã®ã§ç•ªå·ã ã‘å…¥ã‚Œã‚‹ä¿é™ºï¼ˆå¥½ã¿ã§æ¶ˆã—ã¦OKï¼‰
  for(let i=0;i<12;i++){
    if(!arr[i]) arr[i] = `${i+1}`;
  }
  return arr;
}

function getTargetsByScope(scope){
  if(scope === "all"){
    return state.data.students.slice();
  }
  if(scope === "group"){
    return getGroupMembers(state.currentStudent);
  }
  if(scope === "selected"){
    const list = document.getElementById("selectedStudentsList");
    if(!list) return [state.currentStudent];
    const checks = Array.from(list.querySelectorAll("input[type=checkbox]"));
    const names = checks.filter(c=>c.checked).map(c=>c.value);
    return (names.length ? names : [state.currentStudent]);
  }
  // current
  return [state.currentStudent];
}

function applyStepLabelsToTargets(labels, targetNames){
  // targetNamesã®å­ã«ã€Œä¸Šæ›¸ãã€ã‚’ä¿å­˜ã™ã‚‹ï¼ˆå…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã¯è§¦ã‚‰ãªã„ï¼‰
  if(!state.data.stepLabelsByStudent) state.data.stepLabelsByStudent = {};
  targetNames.forEach(n=>{
    state.data.stepLabelsByStudent[n] = labels.slice();
  });
  saveData();
}

function openStepEditor(){
  const panel = document.getElementById("stepEditor");
  if(!panel) return;

  panel.style.display = "block";

  // ç¾åœ¨ã®å…ç«¥ã®ãƒ©ãƒ™ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å…¥åŠ›æ¬„ã«åæ˜ 
  const labels = getStepLabelsFor(state.currentStudent);
  renderStepLabelInputs(labels);

  // é¸æŠé©ç”¨ãƒªã‚¹ãƒˆæç”»
  renderSelectedStudentsList();

  // é©ç”¨å…ˆãŒselectedã®ã¨ãã ã‘ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤º
  const scopeSel = document.getElementById("stepApplyScope");
  const box = document.getElementById("selectedStudentsBox");
  if(scopeSel && box){
    scopeSel.onchange = ()=>{
      box.style.display = (scopeSel.value === "selected") ? "block" : "none";
    };
  }
}

function closeStepEditor(){
  const panel = document.getElementById("stepEditor");
  if(panel) panel.style.display = "none";
}

function renderSelectedStudentsList(){
  const list = document.getElementById("selectedStudentsList");
  if(!list) return;

  list.innerHTML = "";
  state.data.students.forEach(name=>{
    const label = document.createElement("label");
    label.className = "pill";
    label.style.justifyContent = "space-between";

    const span = document.createElement("span");
    span.textContent = name;

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.value = name;
    cb.style.width = "auto";

    // åˆæœŸï¼šç¾åœ¨ã®å…ç«¥ã¯ONã«ã—ã¦ãŠã
    if(name === state.currentStudent) cb.checked = true;

    label.appendChild(span);
    label.appendChild(cb);
    list.appendChild(label);
  });
}

function bindStepEditor(){
  const btn = document.getElementById("btnEditSteps");
  const btnClose = document.getElementById("btnCloseStepEditor");
  const btnSave = document.getElementById("btnSaveStepLabels");
  const btnLoadGlobal = document.getElementById("btnLoadGlobalLabels");
  const btnSaveGlobal = document.getElementById("btnSaveGlobalLabels"); // â˜…è¿½åŠ 
  const scopeSel = document.getElementById("stepApplyScope");
  const box = document.getElementById("selectedStudentsBox");

  if(btn) btn.onclick = openStepEditor;
  if(btnClose) btnClose.onclick = closeStepEditor;

  // â‘  å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã‚’èª­ã¿è¾¼ã¿ï¼ˆè¡¨ç¤ºã ã‘ï¼‰
  if(btnLoadGlobal){
    btnLoadGlobal.onclick = ()=>{
      const labels = state.data.stepLabelsGlobal || safeClone(defaultData.stepLabelsGlobal);
      renderStepLabelInputs(labels);
    };
  }

  // â‘¡ å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã¨ã—ã¦ä¿å­˜ï¼ˆä»Šå›è¿½åŠ ï¼‰
  if(btnSaveGlobal){
    btnSaveGlobal.onclick = ()=>{
      if(!confirm("ä»Šã®å†…å®¹ã‚’å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ")) return;
      const labels = readStepLabelInputs();
      state.data.stepLabelsGlobal = labels.slice();
      // å…¨å“¡ã®ã€Œä¸Šæ›¸ãã€ã‚’æ¶ˆã—ã¦ã€å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬å¼·åˆ¶ã«ã™ã‚‹
      state.data.stepLabelsByStudent = {};
      saveData();
      renderSteps();
      alert("å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
    };
  }

  // â‘¢ å…ç«¥ã¸ã®é©ç”¨
  if(btnSave){
    btnSave.onclick = ()=>{
      const labels = readStepLabelInputs();
      const scope = scopeSel ? scopeSel.value : "current";
      const targets = getTargetsByScope(scope);
      applyStepLabelsToTargets(labels, targets);
      renderSteps();
      closeStepEditor();
      alert(`ä¿å­˜ã—ã¾ã—ãŸï¼ˆé©ç”¨ï¼š${targets.length}äººï¼‰`);
    };
  }
}
function renderSteps(){
  const wrap = document.getElementById("stepsWrap");
  if(!wrap) return;

  ensureStudent(state.currentStudent);
  const arr = state.data.stepsByStudent[state.currentStudent];
  const labels = getStepLabelsFor(state.currentStudent);

  wrap.innerHTML = "";

  for(let i=0;i<12;i++){
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "btn stepBtn";
    btn.dataset.stepIndex = String(i);

    btn.innerHTML = `
      <div style="font-weight:700">${i+1}</div>
      <div style="font-size:11px;color:var(--muted);line-height:1.2; margin-top:2px; overflow-wrap:anywhere">
        ${labels[i] || ""}
      </div>
    `;

    if(arr[i]) btn.classList.add("isDone");

    wrap.appendChild(btn);
  }

  updateStepCount();
}

function bindSteps(){
  const wrap = document.getElementById("stepsWrap");
  const clearBtn = document.getElementById("btnClearSteps");
  if(!wrap) return;

  wrap.addEventListener("click", (e)=>{
  const btn = e.target.closest("button");
  if(!btn || !wrap.contains(btn)) return;

  const idxStr = btn.dataset.stepIndex;
  if(idxStr == null) return;

  const idx = Number(idxStr);
  if(Number.isNaN(idx) || idx < 0 || idx > 11) return;

  ensureStudent(state.currentStudent);
  const arr = state.data.stepsByStudent[state.currentStudent];

  arr[idx] = !arr[idx];
  saveData();
  renderSteps();
});

  if(clearBtn){
    clearBtn.onclick = ()=>{
      if(!confirm("ã“ã®å…ç«¥ã®12æ™‚é–“ãƒã‚§ãƒƒã‚¯ã‚’ã™ã¹ã¦å¤–ã—ã¾ã™ã‹ï¼Ÿ")) return;
      ensureStudent(state.currentStudent);
      state.data.stepsByStudent[state.currentStudent] = Array.from({length:12}, ()=> false);
      saveData();
      renderSteps();
    };
  }
}

// ===== UI: add/delete student =====
function bindRosterButtons(){
  const addBtn = document.getElementById("btnAddStudent");
  const delBtn = document.getElementById("btnDeleteStudent");
  const inp = document.getElementById("newStudentName");

  if(addBtn && inp){
    addBtn.onclick = ()=>{
      const name = (inp.value || "").trim();
      if(!name) return alert("å…ç«¥åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      if(state.data.students.includes(name)) return alert("åŒåã®å…ç«¥ãŒã™ã§ã«ã„ã¾ã™ã€‚");

      state.data.students.push(name);
      ensureStudent(name);

      state.currentStudent = name;
      inp.value = "";
      saveData();
      renderStudentSelect();
      renderGroupUI();
      renderSteps();
    };

    inp.onkeydown = (e)=>{
      if(e.key === "Enter") addBtn.click();
    };
  }

  if(delBtn){
    delBtn.onclick = ()=>{
      if(state.data.students.length <= 1){
        return alert("æœ€å¾Œã®1äººã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚");
      }
      const target = state.currentStudent;
      if(!confirm(`ã€Œ${target}ã€ã‚’åç°¿ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ï¼‰`)) return;

      state.data.students = state.data.students.filter(n => n !== target);

      delete state.data.studentGroup[target];
      delete state.data.progressByStudent[target];
      delete state.data.noteByStudent[target];
      delete state.data.photosByStudent[target];
      delete state.data.stepsByStudent[target];

      state.currentStudent = state.data.students[0];
      saveData();
      renderStudentSelect();
      renderGroupUI();
      renderSteps();
    };
  }

  const autoBtn = document.getElementById("btnAutoGroup");
  if(autoBtn){
    autoBtn.onclick = ()=>{
      if(!confirm("å…ç«¥é †ã« 2ãƒ»2ãƒ»3ï¼ˆG1,G2,G3ï¼‰ã§è‡ªå‹•å‰²ã‚Šå½“ã¦ã—ã¾ã™ã‹ï¼Ÿ")) return;
      autoAssignGroups223();
    };
  }
}

// ===== Photo: 1 per student (localStorage) =====
function bindPhoto(){
  const input = document.getElementById("photoInput");
  const btnClear = document.getElementById("btnClearPhoto");
  if(!input || !btnClear) return;

  input.onchange = async ()=>{
    const file = input.files && input.files[0];
    if(!file) return;

    const dataUrl = await readAsDataURL(file);
    const resized = await resizeDataURL(dataUrl, 1280);

    ensureStudent(state.currentStudent);
    state.data.photosByStudent[state.currentStudent] = resized;
    saveData();

    renderPhotoPreview();
    input.value = "";
  };

  btnClear.onclick = ()=>{
    if(!confirm("ã“ã®å…ç«¥ã®ç”»åƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
    ensureStudent(state.currentStudent);
    state.data.photosByStudent[state.currentStudent] = "";
    saveData();
    renderPhotoPreview();
  };
}

function renderPhotoPreview(){
  const img = document.getElementById("photoPreview");
  if(!img) return;

  const url = (state.data.photosByStudent && state.data.photosByStudent[state.currentStudent]) || "";
  if(url){
    img.src = url;
    img.style.display = "block";
  }else{
    img.removeAttribute("src");
    img.style.display = "none";
  }
}

function readAsDataURL(file){
  return new Promise((resolve, reject)=>{
    const r = new FileReader();
    r.onload = ()=> resolve(String(r.result || ""));
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

function resizeDataURL(dataUrl, maxW){
  return new Promise((resolve)=>{
    const img = new Image();
    img.onload = ()=>{
      const scale = Math.min(1, maxW / img.width);
      const nw = Math.round(img.width * scale);
      const nh = Math.round(img.height * scale);

      const canvas = document.createElement("canvas");
      canvas.width = nw;
      canvas.height = nh;
      const ctx = canvas.getContext("2d");
      if(ctx) ctx.drawImage(img, 0, 0, nw, nh);

      const out = canvas.toDataURL("image/jpeg", 0.82);
      resolve(out);
    };
    img.onerror = ()=> resolve(dataUrl);
    img.src = dataUrl;
  });
}

// ===== Export / Import =====
function exportData(){
  try{
    const payload = {
      version: 1,
      exportedAt: new Date().toISOString(),
      data: state.data
    };
    const json = JSON.stringify(payload, null, 2);

    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(json)
        .then(()=> alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆJSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚\nï¼ˆãƒ¡ãƒ¢å¸³ãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã§ãã¾ã™ï¼‰"))
        .catch(()=> fallbackDownload(json));
    }else{
      fallbackDownload(json);
    }
  }catch(e){
    console.error(e);
    alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
  }
}

function fallbackDownload(text){
  const blob = new Blob([text], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "rika4_hyouka_export.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  alert("JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚");
}

async function importData(){
  const msg =
`ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š
1) ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰è²¼ã‚Šä»˜ã‘ï¼ˆæ¨å¥¨ï¼‰
2) ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠï¼ˆJSONï¼‰

OK â†’ 1) è²¼ã‚Šä»˜ã‘
ã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ 2) ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ`;
  if(confirm(msg)){
    const pasted = prompt("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆJSONã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„");
    if(pasted == null) return;
    doImportFromText(pasted);
  }else{
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "application/json";
    input.onchange = async ()=>{
      const file = input.files && input.files[0];
      if(!file) return;
      const text = await file.text();
      doImportFromText(text);
    };
    input.click();
  }
}

function doImportFromText(text){
  try{
    const obj = JSON.parse(text);
    const d = (obj && obj.data) ? obj.data : obj;

    if(!d || typeof d !== "object") throw new Error("invalid");
    if(!Array.isArray(d.students) || d.students.length === 0) throw new Error("students");

    state.data = {
      students: Array.isArray(d.students) ? d.students.slice() : safeClone(defaultData.students),
      studentGroup: (d.studentGroup && typeof d.studentGroup === "object") ? d.studentGroup : {},
      photosByStudent: (d.photosByStudent && typeof d.photosByStudent === "object") ? d.photosByStudent : {},
      progressByStudent: (d.progressByStudent && typeof d.progressByStudent === "object") ? d.progressByStudent : {},
      noteByStudent: (d.noteByStudent && typeof d.noteByStudent === "object") ? d.noteByStudent : {},
      stepsByStudent: (d.stepsByStudent && typeof d.stepsByStudent === "object") ? d.stepsByStudent : {},
      stepLabelsGlobal: Array.isArray(d.stepLabelsGlobal) ? d.stepLabelsGlobal : safeClone(defaultData.stepLabelsGlobal),
stepLabelsByStudent: (d.stepLabelsByStudent && typeof d.stepLabelsByStudent === "object") ? d.stepLabelsByStudent : {},
    };

    state.data.students.forEach(n=> ensureStudent(n));
    state.currentStudent = state.data.students[0];

    saveData();
    renderStudentSelect();
    renderGroupUI();
    renderSteps();

    alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼");
  }catch(e){
    console.error(e);
    alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nJSONå½¢å¼ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
  }
}

// ===== Reset =====
function resetAll(){
  if(!confirm("æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆåç°¿ãƒ»ç”»åƒãƒ»é€²æ—ãƒ»ãƒ¡ãƒ¢ãŒã™ã¹ã¦æ¶ˆãˆã¾ã™ï¼‰")) return;

  localStorage.removeItem(DATA_KEY);

  state.data = safeClone(defaultData);
  state.currentStudent = state.data.students[0];

  saveData();
  renderStudentSelect();
  renderGroupUI();
  renderSteps();

  alert("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
}

// ===== Init =====
document.addEventListener("DOMContentLoaded", ()=>{
  applyTheme(localStorage.getItem(THEME_KEY) || "dark");
  const tbtn = document.getElementById("btnTheme");
  if(tbtn) tbtn.addEventListener("click", toggleTheme);

  state.data = loadData();
  state.currentStudent = state.data.students[0];
  state.data.students.forEach(n=> ensureStudent(n));

  renderStudentSelect();
  renderGroupUI();
  renderSteps();
  bindRosterButtons();
  bindPhoto();
  bindSteps();
  bindStepEditor();

  bindViewButtons(); // â˜…ã“ã‚Œã‚’è¿½åŠ 
  setView("personal"); // â˜…åˆæœŸè¡¨ç¤ºã‚’ç¢ºå®š

  const exBtn = document.getElementById("btnExport");
  if(exBtn) exBtn.onclick = exportData;

  const imBtn = document.getElementById("btnImport");
  if(imBtn) imBtn.onclick = importData;

  const rsBtn = document.getElementById("btnReset");
  if(rsBtn) rsBtn.onclick = resetAll;
});
</script>
</body>
</html>
